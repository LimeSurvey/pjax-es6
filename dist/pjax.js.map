{"version":3,"file":"pjax.js","sources":["../src/lib/polyfills/Array.prototype.from.js","../src/lib/utility.js","../src/lib/events/on.js","../src/lib/proto/log.js","../src/lib/events/trigger.js","../src/lib/request.js","../src/lib/switches.js","../src/lib/switches-selectors.js","../src/lib/polyfills/Function.prototype.bind.js","../src/lib/proto/attach-link.js","../src/lib/proto/attach-form.js","../node_modules/promise-polyfill/promise.js","../src/lib/eval-script.js","../src/lib/execute-scripts.js","../src/lib/events/off.js","../src/lib/proto/unattach-link.js","../src/lib/proto/unattach-form.js","../src/lib/update-stylesheets.js","../src/lib/proto/parsers.js","../src/lib/domutil.js","../src/index.js"],"sourcesContent":["if(!Array.prototype.from){\r\n    Array.prototype.from = function(enumerable){\r\n        var arr = [];\r\n        for(var i = enumerable.length; i--; arr.unshift(enumerable[i]));\r\n        return arr;\r\n    }\r\n}","/**\r\n * General utility file \r\n * Exports: \r\n * -> forEachEls\r\n * -> getElements\r\n * -> clone\r\n * -> isSupported\r\n * -> newUid\r\n */\r\nimport './polyfills/Array.prototype.from';\r\n\r\nexport const forEachEls = \r\nfunction (els, fn, ctx) {\r\n  if (els instanceof HTMLCollection || els instanceof NodeList || els instanceof Array) {\r\n    return Array.prototype.from(els).forEach((el) => fn.call(ctx, el));\r\n  }\r\n  // assume simple dom element\r\n  return fn.call(ctx, els);\r\n};\r\n\r\nexport const getElements = function (el) {\r\n  return el.querySelectorAll(this.options.elements)\r\n}\r\n\r\nexport const clone = function (obj) {\r\n  if (null === obj || \"object\" != typeof obj) {\r\n    return obj\r\n  }\r\n  const copy = obj.constructor()\r\n  for (var attr in obj) {\r\n    if (attr in obj) {\r\n      copy[attr] = obj[attr];\r\n    }\r\n  }\r\n  return copy;\r\n}\r\n\r\nexport const isSupported = function () {\r\n  // Borrowed wholesale from https://github.com/defunkt/jquery-pjax\r\n  return window.history &&\r\n    window.history.pushState &&\r\n    window.history.replaceState &&\r\n    // pushState isn’t reliable on iOS until 5.\r\n    !navigator.userAgent.match(/((iPod|iPhone|iPad).+\\bOS\\s+[1-4]\\D|WebApps\\/.+CFNetwork)/)\r\n}\r\n\r\nexport const newUid = (function() {\r\n    var counter = 0\r\n    return function() {\r\n      var id = (\"pjax\" + (new Date().getTime())) + \"_\" + counter\r\n      counter++\r\n      return id\r\n    }\r\n  })();\r\n\r\nexport default function() {\r\n    return {\r\n        forEachEls,\r\n        getElements,\r\n        clone,\r\n        isSupported,\r\n        newUid\r\n    }\r\n}","import {forEachEls} from \"../utility\";\r\n\r\nexport default function(els, events, listener, useCapture) {\r\n  events = (typeof events === \"string\" ? events.split(\" \") : events)\r\n\r\n  events.forEach(function(e) {\r\n    forEachEls(els, function(el) {\r\n      el.addEventListener(e, listener, useCapture)\r\n    })\r\n  })\r\n}\r\n","export default function() {\r\n  if ((this.options.debug && this.options.logObject)) {\r\n    if (typeof this.options.logObject.log === \"function\") {\r\n      this.options.logObject.log.apply(this.options.logObject, ['PJAX ->',arguments]);\r\n    }\r\n    // ie is weird\r\n    else if (this.options.logObject.log) {\r\n      this.options.logObject.log(['PJAX ->',arguments]);\r\n    }\r\n  }\r\n}\r\n","import {forEachEls} from \"../utility\";\r\n\r\nexport default function(els, events, opts) {\r\n  events = (typeof events === \"string\" ? events.split(\" \") : events)\r\n\r\n  events.forEach(function(e) {\r\n    var event // = new CustomEvent(e) // doesn't everywhere yet\r\n    event = document.createEvent(\"HTMLEvents\")\r\n    event.initEvent(e, true, true)\r\n    event.eventName = e\r\n    if (opts) {\r\n      Object.keys(opts).forEach(function(key) {\r\n        event[key] = opts[key]\r\n      })\r\n    }\r\n\r\n    forEachEls(els, function(el) {\r\n      var domFix = false\r\n      if (!el.parentNode && el !== document && el !== window) {\r\n        // THANKS YOU IE (9/10//11 concerned)\r\n        // dispatchEvent doesn't work if element is not in the dom\r\n        domFix = true\r\n        document.body.appendChild(el)\r\n      }\r\n      el.dispatchEvent(event)\r\n      if (domFix) {\r\n        el.parentNode.removeChild(el)\r\n      }\r\n    })\r\n  })\r\n}\r\n","export default function(location, options, callback) {\r\n  options = options || {};\r\n  const requestMethod = options.requestMethod || \"GET\";\r\n  const requestPayload = options.requestPayloadString || null;\r\n  const request = new XMLHttpRequest()\r\n\r\n  request.onreadystatechange = function() {\r\n    if (request.readyState === 4) {\r\n      if (request.status === 200) {\r\n        callback(request.responseText, request)\r\n      }\r\n      else {\r\n        callback(null, request)\r\n      }\r\n    }\r\n  }\r\n\r\n  // Add a timestamp as part of the query string if cache busting is enabled\r\n  if (this.options.cacheBust) {\r\n    location += (!/[?&]/.test(location) ? \"?\" : \"&\") + new Date().getTime()\r\n  }\r\n\r\n  request.open(requestMethod.toUpperCase(), location, true)\r\n  request.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\")\r\n\r\n  // Add the request payload if available\r\n  if (options.requestPayloadString != undefined && options.requestPayloadString != \"\") {\r\n    // Send the proper header information along with the request\r\n    request.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\r\n  }\r\n\r\n  request.send(requestPayload)\r\n\r\n  return request\r\n}\r\n","import on from \"./events/on\";\r\nimport './polyfills/Array.prototype.from';\r\n// var off = require(\"./lib/events/on.js\")\r\n// var trigger = require(\"./lib/events/trigger.js\")\r\n\r\n\r\nexport default {\r\n  outerHTML: function(oldEl, newEl) {\r\n    oldEl.outerHTML = newEl.outerHTML\r\n    this.onSwitch()\r\n  },\r\n\r\n  innerHTML: function(oldEl, newEl) {\r\n    oldEl.innerHTML = newEl.innerHTML\r\n    oldEl.className = newEl.className\r\n    this.onSwitch()\r\n  },\r\n\r\n  sideBySide: function(oldEl, newEl, options, switchOptions) {\r\n    let elsToRemove = []\r\n    let elsToAdd = []\r\n    const fragToAppend = document.createDocumentFragment()\r\n\r\n    // height transition are shitty on safari\r\n    // so commented for now (until I found something ?)\r\n    // var relevantHeight = 0\r\n    const animationEventNames = \"animationend webkitAnimationEnd MSAnimationEnd oanimationend\"\r\n    let animatedElsNumber = 0\r\n\r\n    const sexyAnimationEnd = function(e) {\r\n          if (e.target != e.currentTarget) {\r\n            // end triggered by an animation on a child\r\n            return\r\n          }\r\n\r\n          animatedElsNumber--\r\n          if (animatedElsNumber <= 0 && elsToRemove) {\r\n            elsToRemove.forEach(function(el) {\r\n              // browsing quickly can make the el\r\n              // already removed by last page update ?\r\n              if (el.parentNode) {\r\n                el.parentNode.removeChild(el)\r\n              }\r\n            })\r\n\r\n            elsToAdd.forEach(function(el) {\r\n              el.className = el.className.replace(el.getAttribute(\"data-pjax-classes\"), \"\")\r\n              el.removeAttribute(\"data-pjax-classes\")\r\n              // Pjax.off(el, animationEventNames, sexyAnimationEnd, true)\r\n            })\r\n\r\n            elsToAdd = null // free memory\r\n            elsToRemove = null // free memory\r\n\r\n            // assume the height is now useless (avoid bug since there is overflow hidden on the parent)\r\n            // oldEl.style.height = \"auto\"\r\n\r\n            // this is to trigger some repaint (example: picturefill)\r\n            this.onSwitch()\r\n            // Pjax.trigger(window, \"scroll\")\r\n          }\r\n        }.bind(this)\r\n\r\n    // Force height to be able to trigger css animation\r\n    // here we get the relevant height\r\n    // oldEl.parentNode.appendChild(newEl)\r\n    // relevantHeight = newEl.getBoundingClientRect().height\r\n    // oldEl.parentNode.removeChild(newEl)\r\n    // oldEl.style.height = oldEl.getBoundingClientRect().height + \"px\"\r\n\r\n    switchOptions = switchOptions || {}\r\n\r\n    Array.from(oldEl.childNodes).forEach((el) => {\r\n      elsToRemove.push(el)\r\n      if (el.classList && !el.classList.contains(\"js-Pjax-remove\")) {\r\n        // for fast switch, clean element that just have been added, & not cleaned yet.\r\n        if (el.hasAttribute(\"data-pjax-classes\")) {\r\n          el.className = el.className.replace(el.getAttribute(\"data-pjax-classes\"), \"\")\r\n          el.removeAttribute(\"data-pjax-classes\")\r\n        }\r\n        el.classList.add(\"js-Pjax-remove\")\r\n        if (switchOptions.callbacks && switchOptions.callbacks.removeElement) {\r\n          switchOptions.callbacks.removeElement(el)\r\n        }\r\n        if (switchOptions.classNames) {\r\n          el.className += \" \" + switchOptions.classNames.remove + \" \" + (options.backward ? switchOptions.classNames.backward : switchOptions.classNames.forward)\r\n        }\r\n        animatedElsNumber++\r\n        on(el, animationEventNames, sexyAnimationEnd, true)\r\n      }\r\n    });\r\n\r\n    Array.from(newEl.childNodes).forEach((el) => {\r\n      if (el.classList) {\r\n        var addClasses = \"\"\r\n        if (switchOptions.classNames) {\r\n          addClasses = \" js-Pjax-add \" + switchOptions.classNames.add + \" \" + (options.backward ? switchOptions.classNames.forward : switchOptions.classNames.backward)\r\n        }\r\n        if (switchOptions.callbacks && switchOptions.callbacks.addElement) {\r\n          switchOptions.callbacks.addElement(el)\r\n        }\r\n        el.className += addClasses\r\n        el.setAttribute(\"data-pjax-classes\", addClasses)\r\n        elsToAdd.push(el)\r\n        fragToAppend.appendChild(el)\r\n        animatedElsNumber++\r\n        on(el, animationEventNames, sexyAnimationEnd, true)\r\n      }\r\n    })\r\n\r\n    // pass all className of the parent\r\n    oldEl.className = newEl.className\r\n    oldEl.appendChild(fragToAppend)\r\n\r\n    // oldEl.style.height = relevantHeight + \"px\"\r\n  }\r\n}\r\n","import {forEachEls} from './utility';\r\n\r\nimport defaultSwitches from \"./switches\";\r\n\r\nexport default function(switches, switchesOptions, selectors, fromEl, toEl, options) {\r\n  selectors.forEach((selector)  => {\r\n    var newEls = fromEl.querySelectorAll(selector)\r\n    var oldEls = toEl.querySelectorAll(selector)\r\n    if (this.log) {\r\n      this.log(\"Pjax switch\", selector, newEls, oldEls)\r\n    }\r\n    if (newEls.length !== oldEls.length) {\r\n      var throwError = options.onDomDiffers(toEl, fromEl);\r\n      if(throwError) {\r\n        throw \"DOM doesn’t look the same on new loaded page: ’\" + selector + \"’ - new \" + newEls.length + \", old \" + oldEls.length;\r\n      }\r\n    }\r\n\r\n    forEachEls(newEls, function(newEl, i) {\r\n      var oldEl = oldEls[i]\r\n      if (this.log) {\r\n        this.log(\"newEl\", newEl, \"oldEl\", oldEl)\r\n      }\r\n      if (switches[selector]) {\r\n        switches[selector].bind(this)(oldEl, newEl, options, switchesOptions[selector])\r\n      }\r\n      else {\r\n        defaultSwitches.outerHTML.bind(this)(oldEl, newEl, options)\r\n      }\r\n    }, this)\r\n  }, this)\r\n}\r\n","if (!Function.prototype.bind) {\r\n  Function.prototype.bind = function(oThis) {\r\n    if (typeof this !== \"function\") {\r\n      // closest thing possible to the ECMAScript 5 internal IsCallable function\r\n      throw new TypeError(\"Function.prototype.bind - what is trying to be bound is not callable\")\r\n    }\r\n\r\n    var aArgs = Array.prototype.slice.call(arguments, 1)\r\n    var that = this\r\n    var Fnoop = function() {}\r\n    var fBound = function() {\r\n      return that.apply(this instanceof Fnoop && oThis ? this : oThis, aArgs.concat(Array.prototype.slice.call(arguments)))\r\n    }\r\n\r\n    Fnoop.prototype = this.prototype\r\n    fBound.prototype = new Fnoop()\r\n\r\n    return fBound\r\n  }\r\n}\r\n","import \"../polyfills/Function.prototype.bind\";\r\n\r\nimport on from \"../events/on\";\r\nimport {\r\n  clone\r\n} from \"../utility\";\r\n\r\n\r\nconst attrClick = \"data-pjax-click-state\"\r\nconst attrKey = \"data-pjax-keyup-state\"\r\n\r\nconst linkAction = function (el, event) {\r\n  // Don’t break browser special behavior on links (like page in new window)\r\n  if (event.which > 1 || event.metaKey || event.ctrlKey || event.shiftKey || event.altKey) {\r\n    el.setAttribute(attrClick, \"modifier\")\r\n    return\r\n  }\r\n\r\n  // we do test on href now to prevent unexpected behavior if for some reason\r\n  // user have href that can be dynamically updated\r\n\r\n  // Ignore external links.\r\n  if (el.protocol !== window.location.protocol || el.host !== window.location.host) {\r\n    el.setAttribute(attrClick, \"external\")\r\n    return\r\n  }\r\n\r\n  // Ignore click if we are on an anchor on the same page\r\n  if (el.pathname === window.location.pathname && el.hash.length > 0) {\r\n    el.setAttribute(attrClick, \"anchor-present\")\r\n    return\r\n  }\r\n\r\n  // Ignore anchors on the same page (keep native behavior)\r\n  if (el.hash && el.href.replace(el.hash, \"\") === window.location.href.replace(location.hash, \"\")) {\r\n    el.setAttribute(attrClick, \"anchor\")\r\n    return\r\n  }\r\n\r\n  // Ignore empty anchor \"foo.html#\"\r\n  if (el.href === window.location.href.split(\"#\")[0] + \"#\") {\r\n    el.setAttribute(attrClick, \"anchor-empty\")\r\n    return\r\n  }\r\n\r\n  event.preventDefault()\r\n\r\n  // don’t do \"nothing\" if user try to reload the page by clicking the same link twice\r\n  if (\r\n    this.options.currentUrlFullReload &&\r\n    el.href === window.location.href.split(\"#\")[0]\r\n  ) {\r\n    el.setAttribute(attrClick, \"reload\")\r\n    this.reload()\r\n    return\r\n  }\r\n  this.options.requestOptions = this.options.requestOptions || {};\r\n  el.setAttribute(attrClick, \"load\")\r\n  this.loadUrl(el.href, clone(this.options))\r\n}\r\n\r\nconst isDefaultPrevented = function (event) {\r\n  return event.defaultPrevented || event.returnValue === false;\r\n}\r\n\r\nexport default function () {\r\n  return (el) => {\r\n\r\n    on(el, \"click\", (event) => {\r\n      if (isDefaultPrevented(event)) {\r\n        return\r\n      }\r\n\r\n      linkAction.call(this, el, event)\r\n    });\r\n\r\n    on(el, \"keyup\", (event) => {\r\n      if (isDefaultPrevented(event)) {\r\n        return\r\n      }\r\n\r\n      // Don’t break browser special behavior on links (like page in new window)\r\n      if (event.which > 1 || event.metaKey || event.ctrlKey || event.shiftKey || event.altKey) {\r\n        el.setAttribute(attrKey, \"modifier\")\r\n        return\r\n      }\r\n\r\n      if (event.keyCode == 13) {\r\n        linkAction.call(this, el, event)\r\n      }\r\n    });\r\n  }\r\n}\r\n","import \"../polyfills/Function.prototype.bind\";\r\n\r\nimport on from \"../events/on\";\r\nimport {\r\n  clone\r\n} from \"../utility\";\r\n\r\nconst attrClick = \"data-pjax-submit-state\"\r\n\r\nconst formAction = function (el, event) {\r\n\r\n  this.options.requestOptions = {\r\n    requestUrl: el.getAttribute('action') || window.location.href,\r\n    requestMethod: el.getAttribute('method') || 'GET',\r\n  }\r\n\r\n  //create a testable virtual link of the form action\r\n  const virtLinkElement = document.createElement('a');\r\n  virtLinkElement.setAttribute('href', this.options.requestOptions.requestUrl);\r\n\r\n  // Ignore external links.\r\n  if (virtLinkElement.protocol !== window.location.protocol || virtLinkElement.host !== window.location.host) {\r\n    el.setAttribute(attrClick, \"external\");\r\n    return\r\n  }\r\n\r\n  // Ignore click if we are on an anchor on the same page\r\n  if (virtLinkElement.pathname === window.location.pathname && virtLinkElement.hash.length > 0) {\r\n    el.setAttribute(attrClick, \"anchor-present\");\r\n    return\r\n  }\r\n\r\n  // Ignore empty anchor \"foo.html#\"\r\n  if (virtLinkElement.href === window.location.href.split(\"#\")[0] + \"#\") {\r\n    el.setAttribute(attrClick, \"anchor-empty\")\r\n    return\r\n  }\r\n\r\n  // if declared as a full reload, just normally submit the form\r\n  if (this.options.currentUrlFullReload) {\r\n    el.setAttribute(attrClick, \"reload\");\r\n    return;\r\n  }\r\n\r\n  event.preventDefault()\r\n  const nameList = [];\r\n  const paramObject = [];\r\n\r\n  for (let elementKey in el.elements) {\r\n    const element = el.elements[elementKey];\r\n    if (!!element.name && element.attributes !== undefined && element.tagName.toLowerCase() !== 'button') {\r\n      if ((element.type !== 'checkbox' && element.type !== 'radio') || element.checked) {\r\n        if (nameList.indexOf(element.name) === -1) {\r\n          nameList.push(element.name);\r\n\r\n          if (String(element.nodeName).toLowerCase() === 'select' && element.multiple == true) {\r\n            const selected = Array.from(element.options).map(item => (item.selected ? item.value : null));\r\n            paramObject.push({\r\n              name: encodeURIComponent(element.name),\r\n              value: selected\r\n            });\r\n            return;\r\n          }\r\n          paramObject.push({\r\n            name: encodeURIComponent(element.name),\r\n            value: encodeURIComponent(element.value)\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  //Creating a getString\r\n  const paramsString = (paramObject.map(value => value.name + \"=\" + value.value)).join('&');\r\n\r\n  this.options.requestOptions.requestPayload = paramObject;\r\n  this.options.requestOptions.requestPayloadString = paramsString;\r\n\r\n  el.setAttribute(attrClick, \"submit\");\r\n\r\n  this.loadUrl(virtLinkElement.href, clone(this.options))\r\n\r\n};\r\n\r\nconst isDefaultPrevented = function (event) {\r\n  return event.defaultPrevented || event.returnValue === false;\r\n};\r\n\r\n\r\nexport default function () {\r\n  return (el) => {\r\n    on(el, \"submit\", (event) => {\r\n      if (isDefaultPrevented(event)) {\r\n        return\r\n      }\r\n\r\n      formAction.call(this, el, event)\r\n    });\r\n  }\r\n}\r\n","(function (root) {\n\n  // Store setTimeout reference so promise-polyfill will be unaffected by\n  // other code modifying setTimeout (like sinon.useFakeTimers())\n  var setTimeoutFunc = setTimeout;\n\n  function noop() {}\n  \n  // Polyfill for Function.prototype.bind\n  function bind(fn, thisArg) {\n    return function () {\n      fn.apply(thisArg, arguments);\n    };\n  }\n\n  function Promise(fn) {\n    if (!(this instanceof Promise)) throw new TypeError('Promises must be constructed via new');\n    if (typeof fn !== 'function') throw new TypeError('not a function');\n    this._state = 0;\n    this._handled = false;\n    this._value = undefined;\n    this._deferreds = [];\n\n    doResolve(fn, this);\n  }\n\n  function handle(self, deferred) {\n    while (self._state === 3) {\n      self = self._value;\n    }\n    if (self._state === 0) {\n      self._deferreds.push(deferred);\n      return;\n    }\n    self._handled = true;\n    Promise._immediateFn(function () {\n      var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n      if (cb === null) {\n        (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n        return;\n      }\n      var ret;\n      try {\n        ret = cb(self._value);\n      } catch (e) {\n        reject(deferred.promise, e);\n        return;\n      }\n      resolve(deferred.promise, ret);\n    });\n  }\n\n  function resolve(self, newValue) {\n    try {\n      // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n      if (newValue === self) throw new TypeError('A promise cannot be resolved with itself.');\n      if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\n        var then = newValue.then;\n        if (newValue instanceof Promise) {\n          self._state = 3;\n          self._value = newValue;\n          finale(self);\n          return;\n        } else if (typeof then === 'function') {\n          doResolve(bind(then, newValue), self);\n          return;\n        }\n      }\n      self._state = 1;\n      self._value = newValue;\n      finale(self);\n    } catch (e) {\n      reject(self, e);\n    }\n  }\n\n  function reject(self, newValue) {\n    self._state = 2;\n    self._value = newValue;\n    finale(self);\n  }\n\n  function finale(self) {\n    if (self._state === 2 && self._deferreds.length === 0) {\n      Promise._immediateFn(function() {\n        if (!self._handled) {\n          Promise._unhandledRejectionFn(self._value);\n        }\n      });\n    }\n\n    for (var i = 0, len = self._deferreds.length; i < len; i++) {\n      handle(self, self._deferreds[i]);\n    }\n    self._deferreds = null;\n  }\n\n  function Handler(onFulfilled, onRejected, promise) {\n    this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n    this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n    this.promise = promise;\n  }\n\n  /**\n   * Take a potentially misbehaving resolver function and make sure\n   * onFulfilled and onRejected are only called once.\n   *\n   * Makes no guarantees about asynchrony.\n   */\n  function doResolve(fn, self) {\n    var done = false;\n    try {\n      fn(function (value) {\n        if (done) return;\n        done = true;\n        resolve(self, value);\n      }, function (reason) {\n        if (done) return;\n        done = true;\n        reject(self, reason);\n      });\n    } catch (ex) {\n      if (done) return;\n      done = true;\n      reject(self, ex);\n    }\n  }\n\n  Promise.prototype['catch'] = function (onRejected) {\n    return this.then(null, onRejected);\n  };\n\n  Promise.prototype.then = function (onFulfilled, onRejected) {\n    var prom = new (this.constructor)(noop);\n\n    handle(this, new Handler(onFulfilled, onRejected, prom));\n    return prom;\n  };\n\n  Promise.all = function (arr) {\n    return new Promise(function (resolve, reject) {\n      if (!arr || typeof arr.length === 'undefined') throw new TypeError('Promise.all accepts an array');\n      var args = Array.prototype.slice.call(arr);\n      if (args.length === 0) return resolve([]);\n      var remaining = args.length;\n\n      function res(i, val) {\n        try {\n          if (val && (typeof val === 'object' || typeof val === 'function')) {\n            var then = val.then;\n            if (typeof then === 'function') {\n              then.call(val, function (val) {\n                res(i, val);\n              }, reject);\n              return;\n            }\n          }\n          args[i] = val;\n          if (--remaining === 0) {\n            resolve(args);\n          }\n        } catch (ex) {\n          reject(ex);\n        }\n      }\n\n      for (var i = 0; i < args.length; i++) {\n        res(i, args[i]);\n      }\n    });\n  };\n\n  Promise.resolve = function (value) {\n    if (value && typeof value === 'object' && value.constructor === Promise) {\n      return value;\n    }\n\n    return new Promise(function (resolve) {\n      resolve(value);\n    });\n  };\n\n  Promise.reject = function (value) {\n    return new Promise(function (resolve, reject) {\n      reject(value);\n    });\n  };\n\n  Promise.race = function (values) {\n    return new Promise(function (resolve, reject) {\n      for (var i = 0, len = values.length; i < len; i++) {\n        values[i].then(resolve, reject);\n      }\n    });\n  };\n\n  // Use polyfill for setImmediate for performance gains\n  Promise._immediateFn = (typeof setImmediate === 'function' && function (fn) { setImmediate(fn); }) ||\n    function (fn) {\n      setTimeoutFunc(fn, 0);\n    };\n\n  Promise._unhandledRejectionFn = function _unhandledRejectionFn(err) {\n    if (typeof console !== 'undefined' && console) {\n      console.warn('Possible Unhandled Promise Rejection:', err); // eslint-disable-line no-console\n    }\n  };\n\n  /**\n   * Set the immediate function to execute callbacks\n   * @param fn {function} Function to execute\n   * @deprecated\n   */\n  Promise._setImmediateFn = function _setImmediateFn(fn) {\n    Promise._immediateFn = fn;\n  };\n\n  /**\n   * Change the function to execute on unhandled rejection\n   * @param {function} fn Function to execute on unhandled rejection\n   * @deprecated\n   */\n  Promise._setUnhandledRejectionFn = function _setUnhandledRejectionFn(fn) {\n    Promise._unhandledRejectionFn = fn;\n  };\n  \n  if (typeof module !== 'undefined' && module.exports) {\n    module.exports = Promise;\n  } else if (!root.Promise) {\n    root.Promise = Promise;\n  }\n\n})(this);\n","import 'promise-polyfill';\r\n\r\nexport default function (el) {\r\n\r\n  const querySelector = this.options.mainScriptElement;\r\n  const code = (el.text || el.textContent || el.innerHTML || \"\");\r\n\r\n  this.log(\"Evaluating Script: \", el);\r\n  if (code.match(\"document.write\")) {\r\n    if (console && this.options.logObject.log) {\r\n      this.options.logObject.log(\"Script contains document.write. Can’t be executed correctly. Code skipped \", el)\r\n    }\r\n    return false\r\n  }\r\n\r\n  const src = (el.src || \"\");\r\n  const parent = el.parentNode || document.querySelector(querySelector) || document.documentElement;\r\n  const script = document.createElement(\"script\");\r\n\r\n  const promise = new Promise((resolve) => {\r\n    script.type = \"text/javascript\"\r\n    if (src != \"\") {\r\n      script.src = src;\r\n      script.addEventListener('load', function () {\r\n        resolve(src);\r\n      });\r\n      script.async = true; // force asynchronous loading of peripheral js\r\n    }\r\n\r\n    if (code != \"\") {\r\n      try {\r\n        script.appendChild(document.createTextNode(code))\r\n      } catch (e) {\r\n        // old IEs have funky script nodes\r\n        script.text = code\r\n      }\r\n      resolve('text-node');\r\n    }\r\n  });\r\n\r\n  this.log('ParentElement => ', parent);\r\n\r\n  // execute\r\n  parent.appendChild(script);\r\n  parent.removeChild(script)\r\n  // avoid pollution only in head or body tags\r\n  // of if the setting removeScriptsAfterParsing is active\r\n  if (([\"head\", \"body\"].indexOf(parent.tagName.toLowerCase()) > 0) || (this.options.removeScriptsAfterParsing === true)) {\r\n      //Removed this because not necessary in our setup\r\n  }\r\n\r\n  return promise;\r\n}\r\n","import {\r\n  forEachEls\r\n} from \"./utility\"\r\nimport evalScript from \"./eval-script\"\r\n\r\n// Finds and executes scripts (used for newly added elements)\r\n// Needed since innerHTML does not run scripts\r\nconst executeScripts = function () {\r\n  return (el) => {\r\n\r\n    this.log(\"Executing scripts for \", el);\r\n\r\n    var loadingScripts = [];\r\n\r\n    if (el === undefined) return Promise.resolve();\r\n\r\n    if (el.tagName.toLowerCase() === \"script\") {\r\n      evalScript.call(this, el);\r\n    }\r\n\r\n    forEachEls(el.querySelectorAll(\"script\"), (script) => {\r\n      if (!script.type || script.type.toLowerCase() === \"text/javascript\") {\r\n        // if (script.parentNode) {\r\n        //   script.parentNode.removeChild(script)\r\n        // }\r\n        loadingScripts.push(evalScript.call(this, script));\r\n      }\r\n    }, this);\r\n\r\n    return loadingScripts;\r\n  }\r\n}\r\n\r\nexport default executeScripts;\r\n","import {forEachEls} from \"../utility\";\r\n\r\nexport default function(els, events, listener, useCapture) {\r\n  events = (typeof events === \"string\" ? events.split(\" \") : events)\r\n\r\n  events.forEach(function(e) {\r\n    forEachEls(els, function(el) {\r\n      el.removeEventListener(e, listener, useCapture)\r\n    })\r\n  })\r\n}\r\n","import \"../polyfills/Function.prototype.bind\";\r\n\r\nimport off from \"../events/off\";\r\nimport {\r\n  clone\r\n} from \"../utility\";\r\n\r\n\r\nconst attrClick = \"data-pjax-click-state\";\r\nconst attrKey = \"data-pjax-keyup-state\";\r\n\r\nconst linkAction = function (el, event) {\r\n  // Don’t break browser special behavior on links (like page in new window)\r\n  if (event.which > 1 || event.metaKey || event.ctrlKey || event.shiftKey || event.altKey) {\r\n    el.setAttribute(attrClick, \"modifier\")\r\n    return\r\n  }\r\n\r\n  // we do test on href now to prevent unexpected behavior if for some reason\r\n  // user have href that can be dynamically updated\r\n\r\n  // Ignore external links.\r\n  if (el.protocol !== window.location.protocol || el.host !== window.location.host) {\r\n    el.setAttribute(attrClick, \"external\")\r\n    return\r\n  }\r\n\r\n  // Ignore click if we are on an anchor on the same page\r\n  if (el.pathname === window.location.pathname && el.hash.length > 0) {\r\n    el.setAttribute(attrClick, \"anchor-present\")\r\n    return\r\n  }\r\n\r\n  // Ignore anchors on the same page (keep native behavior)\r\n  if (el.hash && el.href.replace(el.hash, \"\") === window.location.href.replace(location.hash, \"\")) {\r\n    el.setAttribute(attrClick, \"anchor\")\r\n    return\r\n  }\r\n\r\n  // Ignore empty anchor \"foo.html#\"\r\n  if (el.href === window.location.href.split(\"#\")[0] + \"#\") {\r\n    el.setAttribute(attrClick, \"anchor-empty\")\r\n    return\r\n  }\r\n\r\n  event.preventDefault()\r\n\r\n  // don’t do \"nothing\" if user try to reload the page by clicking the same link twice\r\n  if (\r\n    this.options.currentUrlFullReload &&\r\n    el.href === window.location.href.split(\"#\")[0]\r\n  ) {\r\n    el.setAttribute(attrClick, \"reload\")\r\n    this.reload()\r\n    return\r\n  }\r\n  this.options.requestOptions = this.options.requestOptions || {};\r\n  el.setAttribute(attrClick, \"load\")\r\n  this.loadUrl(el.href, clone(this.options))\r\n}\r\n\r\nconst isDefaultPrevented = function (event) {\r\n  return event.defaultPrevented || event.returnValue === false;\r\n}\r\n\r\nexport default function () {\r\n  return (el) => {\r\n    off(el, \"click\", (event) => {\r\n      if (isDefaultPrevented(event)) {\r\n        return\r\n      }\r\n\r\n      linkAction.call(this, el, event)\r\n    })\r\n\r\n    off(el, \"keyup\", (event) => {\r\n      if (isDefaultPrevented(event)) {\r\n        return\r\n      }\r\n\r\n      // Don’t break browser special behavior on links (like page in new window)\r\n      if (event.which > 1 || event.metaKey || event.ctrlKey || event.shiftKey || event.altKey) {\r\n        el.setAttribute(attrKey, \"modifier\")\r\n        return\r\n      }\r\n\r\n      if (event.keyCode == 13) {\r\n        linkAction.call(this, el, event)\r\n      }\r\n    })\r\n  }\r\n}\r\n","import \"../polyfills/Function.prototype.bind\";\r\n\r\nimport off from \"../events/off\";\r\nimport {\r\n  clone\r\n} from \"../utility\";\r\n\r\nconst attrClick = \"data-pjax-click-state\"\r\n\r\nconst formAction = function (el, event) {\r\n\r\n  this.options.requestOptions = {\r\n    requestUrl: el.getAttribute('action') || window.location.href,\r\n    requestMethod: el.getAttribute('method') || 'GET',\r\n  }\r\n\r\n  //create a testable virtual link of the form action\r\n  var virtLinkElement = document.createElement('a');\r\n  virtLinkElement.setAttribute('href', this.options.requestOptions.requestUrl);\r\n\r\n  // Ignore external links.\r\n  if (virtLinkElement.protocol !== window.location.protocol || virtLinkElement.host !== window.location.host) {\r\n    el.setAttribute(attrClick, \"external\");\r\n    return\r\n  }\r\n\r\n  // Ignore click if we are on an anchor on the same page\r\n  if (virtLinkElement.pathname === window.location.pathname && virtLinkElement.hash.length > 0) {\r\n    el.setAttribute(attrClick, \"anchor-present\");\r\n    return\r\n  }\r\n\r\n  // Ignore empty anchor \"foo.html#\"\r\n  if (virtLinkElement.href === window.location.href.split(\"#\")[0] + \"#\") {\r\n    el.setAttribute(attrClick, \"anchor-empty\")\r\n    return\r\n  }\r\n\r\n  // if declared as a full reload, just normally submit the form\r\n  if (this.options.currentUrlFullReload) {\r\n    el.setAttribute(attrClick, \"reload\");\r\n    return;\r\n  }\r\n\r\n  event.preventDefault()\r\n  const nameList = [];\r\n  const paramObject = [];\r\n  for (let elementKey in el.elements) {\r\n    const element = el.elements[elementKey];\r\n    if (!!element.name && element.attributes !== undefined && element.tagName.toLowerCase() !== 'button') {\r\n      if (\r\n        (element.type !== 'checkbox' && element.type !== 'radio') || element.checked\r\n      ) {\r\n        if (nameList.indexOf(element.name) === -1) {\r\n          nameList.push(element.name);\r\n          paramObject.push({\r\n            name: encodeURIComponent(element.name),\r\n            value: encodeURIComponent(element.value)\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n\r\n  //Creating a getString\r\n  const paramsString = (paramObject.map(value => value.name + \"=\" + value.value)).join('&');\r\n\r\n  this.options.requestOptions.requestPayload = paramObject;\r\n  this.options.requestOptions.requestPayloadString = paramsString;\r\n\r\n  el.setAttribute(attrClick, \"submit\");\r\n\r\n  this.loadUrl(virtLinkElement.href, clone(this.options))\r\n\r\n};\r\n\r\nconst isDefaultPrevented = function (event) {\r\n  return event.defaultPrevented || event.returnValue === false;\r\n};\r\n\r\n\r\nexport default function () {\r\n  return (el) => {\r\n\r\n    off(el, \"submit\", function (event) {\r\n      if (isDefaultPrevented(event)) {\r\n        return\r\n      }\r\n\r\n      formAction.call(this, el, event)\r\n    })\r\n\r\n    off(el, \"keyup\", (event) => {\r\n      if (isDefaultPrevented(event)) {\r\n        return\r\n      }\r\n\r\n      if (event.keyCode == 13) {\r\n        formAction.call(this, el, event)\r\n      }\r\n    })\r\n  }\r\n}\r\n","import './polyfills/Array.prototype.from';\r\nimport {\r\n  forEachEls\r\n} from './utility';\r\nexport default function () {\r\n  return (elements, oldElements) => {\r\n    this.log(\"styleheets old elements\", oldElements);\r\n    this.log(\"styleheets new elements\", elements);\r\n\r\n    forEachEls(elements, (newEl) => {\r\n\r\n      const resemblingOld = Array.from(oldElements).reduce((acc, oldEl) => {\r\n        acc = ((oldEl.href === newEl.href) ? oldEl : acc);\r\n        return acc;\r\n      }, null);\r\n\r\n      if (resemblingOld !== null) {\r\n        if (this.log) {\r\n          this.log(\"old stylesheet found not resetting\");\r\n        }\r\n      } else {\r\n        if (this.log) {\r\n          this.log(\"new stylesheet => add to head\");\r\n        }\r\n        const head = document.getElementsByTagName('head')[0];\r\n        const link = document.createElement('link');\r\n\r\n        link.setAttribute('href', newEl.href);\r\n        link.setAttribute('rel', 'stylesheet');\r\n        link.setAttribute('type', 'text/css');\r\n        head.appendChild(link);\r\n      }\r\n    });\r\n  }\r\n}\r\n","/**\r\n * Collection of parsing methods\r\n *  Exports:\r\n *  -> parseDOMUnload\r\n *  -> parseDOM\r\n *  -> parseElementUnload\r\n *  -> parseElement\r\n *  -> parseOptions\r\n */\r\n\r\nimport {\r\n  forEachEls\r\n} from \"../utility\";\r\n\r\n\r\n\r\nexport default function () {\r\n  return {\r\n    parseElementUnload: function (el) {\r\n      switch (el.tagName.toLowerCase()) {\r\n        case \"a\":\r\n          // only attach link if el does not already have link attached\r\n          if (!el.hasAttribute('data-pjax-click-state')) {\r\n            this.unattachLink(el)\r\n          }\r\n          break\r\n\r\n        case \"form\":\r\n          // only attach link if el does not already have link attached\r\n          if (!el.hasAttribute('data-pjax-click-state')) {\r\n            this.unattachForm(el)\r\n          }\r\n          break\r\n\r\n        default:\r\n          throw \"Pjax can only be applied on <a> or <form> submit\"\r\n      }\r\n    },\r\n\r\n    parseElement: function (el) {\r\n      switch (el.tagName.toLowerCase()) {\r\n        case \"a\":\r\n          // only attach link if el does not already have link attached\r\n          if (!el.hasAttribute('data-pjax-click-state')) {\r\n            this.attachLink(el)\r\n          }\r\n          break\r\n\r\n        case \"form\":\r\n          // only attach link if el does not already have link attached\r\n          if (!el.hasAttribute('data-pjax-click-state')) {\r\n            this.attachForm(el)\r\n          }\r\n          break\r\n\r\n        default:\r\n          throw \"Pjax can only be applied on <a> or <form> submit\"\r\n      }\r\n    },\r\n    parseDOMUnload: function (el) {\r\n      forEachEls(this.getElements(el), this.parseElementUnload, this)\r\n    },\r\n\r\n    parseDOM: function (el) {\r\n      forEachEls(this.getElements(el), this.parseElement, this)\r\n    },\r\n\r\n    parseOptions: function (options) {\r\n      this.options = options;\r\n\r\n      this.options.elements = this.options.elements || \"a[href], form[action]\";\r\n      this.options.reRenderCSS = this.options.reRenderCSS || false;\r\n      this.options.forceRedirectOnFail = this.options.forceRedirectOnFail || false;\r\n      this.options.scriptloadtimeout = this.options.scriptloadtimeout || 1000;\r\n      this.options.mainScriptElement = this.options.mainScriptElement || \"head\";\r\n      this.options.removeScriptsAfterParsing = this.options.removeScriptsAfterParsing || true;\r\n      this.options.logObject = this.options.logObject || console;\r\n      this.options.latestChance = this.options.latestChance || null;\r\n      this.options.selectors = this.options.selectors || [\"title\", \".js-Pjax\"];\r\n      this.options.switches = this.options.switches || {};\r\n      this.options.switchesOptions = this.options.switchesOptions || {};\r\n      this.options.history = this.options.history || true;\r\n      this.options.onDomDiffers = this.options.onDomDiffers || (() => true);\r\n      this.options.pjaxErrorHandler = this.options.pjaxErrorHandler || (() => false);\r\n      this.options.onJsonDocument = this.options.onJsonDocument || (() => true);\r\n      this.options.analytics = this.options.analytics || (() => {\r\n        // options.backward or options.foward can be true or undefined\r\n        // by default, we do track back/foward hit\r\n        // https://productforums.google.com/forum/#!topic/analytics/WVwMDjLhXYk\r\n        if (window._gaq) {\r\n          window._gaq.push([\"_trackPageview\"])\r\n        }\r\n        if (window.ga) {\r\n          window.ga(\"send\", \"pageview\", {\r\n            page: location.pathname,\r\n            title: document.title\r\n          })\r\n        }\r\n      });\r\n      this.options.scrollTo = (typeof this.options.scrollTo === 'undefined') ? 0 : this.options.scrollTo;\r\n      this.options.cacheBust = (typeof this.options.cacheBust === 'undefined') ? true : this.options.cacheBust\r\n      this.options.debug = this.options.debug || false\r\n\r\n      // we can’t replace body.outerHTML or head.outerHTML\r\n      // it create a bug where new body or new head are created in the dom\r\n      // if you set head.outerHTML, a new body tag is appended, so the dom get 2 body\r\n      // & it break the switchFallback which replace head & body\r\n      if (!this.options.switches.head) {\r\n        this.options.switches.head = this.switchElementsAlt\r\n      }\r\n      if (!this.options.switches.body) {\r\n        this.options.switches.body = this.switchElementsAlt\r\n      }\r\n      if (typeof options.analytics !== \"function\") {\r\n        options.analytics = function () {}\r\n      }\r\n    }\r\n  };\r\n};\r\n","/**\r\n * Exports\r\n *  -> refresh\r\n *  -> reload\r\n *  -> foreachSelectors\r\n *  -> unattach\r\n */\r\nimport {\r\n  forEachEls\r\n} from './utility';\r\nimport off from \"./events/off\";\r\nexport default function () {\r\n  return {\r\n    refresh: (el) => {\r\n      this.parseDOM(el || document)\r\n    },\r\n\r\n    reload: function () {\r\n      window.location.reload()\r\n    },\r\n\r\n    foreachSelectors: (selectors, cb, context, DOMcontext) => {\r\n      DOMcontext = DOMcontext || document\r\n      selectors.forEach(function (selector) {\r\n        forEachEls(DOMcontext.querySelectorAll(selector), cb, context)\r\n      })\r\n    },\r\n\r\n    unattach: (el) => {\r\n      forEachEls(this.getElements(el), (el) => {\r\n        off(el, 'click');\r\n        off(el, 'keyup');\r\n      }, this)\r\n    }\r\n  };\r\n}\r\n","\"use strict\";\r\n\r\nimport on from \"./lib/events/on.js\";\r\nimport log from \"./lib/proto/log.js\";\r\nimport trigger from \"./lib/events/trigger.js\";\r\nimport doRequest from \"./lib/request.js\";\r\nimport switchSelectors from './lib/switches-selectors.js';\r\nimport getAttachLink from \"./lib/proto/attach-link.js\";\r\nimport getAttachForm from \"./lib/proto/attach-form.js\";\r\nimport getExecuteScripts from './lib/execute-scripts.js';\r\nimport getUnattachLink from \"./lib/proto/unattach-link.js\";\r\nimport getUnattachForm from \"./lib/proto/unattach-form.js\";\r\nimport getUpdateStylesheets from \"./lib/update-stylesheets.js\";\r\nimport getUtility from './lib/utility.js';\r\nimport getParsers from \"./lib/proto/parsers.js\";\r\nimport getDomUtils from \"./lib/domutil.js\";\r\n\r\nconst PjaxFactory = function () {\r\n\r\n  class Pjax {\r\n\r\n    constructor(options) {\r\n      this.firstrun = true\r\n      this.oUtilities = getUtility();\r\n      this.oDomUtils = getDomUtils.apply(this);\r\n      this.oParsers = getParsers.apply(this);\r\n      this.log = log;\r\n\r\n      this.doRequest = doRequest;\r\n      this.getElements = this.oUtilities.getElements;\r\n      this.parseElementUnload = this.oParsers.parseElementUnload;\r\n      this.parseElement = this.oParsers.parseElement;\r\n      this.parseDOM = this.oParsers.parseDOM;\r\n      this.parseDOMUnload = this.oParsers.parseDOMUnload;\r\n      this.refresh = this.oDomUtils.refresh;\r\n      this.reload = this.oDomUtils.reload;\r\n      this.isSupported = this.oUtilities.isSupported;\r\n      this.attachLink = getAttachLink.apply(this);\r\n      this.attachForm = getAttachForm.apply(this);\r\n      this.unattachLink = getUnattachLink.apply(this);\r\n      this.unattachForm = getUnattachForm.apply(this);\r\n      this.updateStylesheets = getUpdateStylesheets.apply(this);\r\n\r\n      this.oParsers.parseOptions.apply(this, [options])\r\n      this.log(\"Pjax options\", this.options)\r\n      this.maxUid = this.lastUid = this.oUtilities.newUid()\r\n      this.parseDOM(document)\r\n\r\n      on(window, \"popstate\", (st) => {\r\n        this.log(\"OPT -> \", state);\r\n        \r\n        if (st.state) {\r\n          const opt = this.oUtilities.clone(this.options);\r\n\r\n          opt.url = st.state.url;\r\n          opt.title = st.state.title;\r\n          opt.history = false;\r\n          opt.requestOptions = {};\r\n            \r\n            this.log(\"OPT -> \", opt)\r\n            this.log(\"State UID\", st.state.uid);\r\n            this.log(\"lastUID\", this.lastUid);\r\n\r\n          if (st.state.uid < this.lastUid) {\r\n            opt.backward = true\r\n          } else {\r\n            opt.forward = true\r\n          }\r\n          this.lastUid = st.state.uid\r\n\r\n          // @todo implement history cache here, based on uid\r\n          this.loadUrl(st.state.url, opt)\r\n        }\r\n      });\r\n\r\n      return this;\r\n    }\r\n\r\n\r\n    forEachSelectors(cb, context, DOMcontext) {\r\n      return oDomUtils.foreachSelectors(this.options.selectors, cb, context, DOMcontext)\r\n    }\r\n\r\n    switchSelectors(selectors, fromEl, toEl, options) {\r\n      return switchSelectors(this.options.switches, this.options.switchesOptions, selectors, fromEl, toEl, options)\r\n    }\r\n\r\n\r\n    latestChance(href) {\r\n      window.location.href = href;\r\n      return false;\r\n    }\r\n\r\n    onSwitch() {\r\n      trigger(window, \"resize scroll\")\r\n    }\r\n\r\n    loadContent(html, options) {\r\n      const fnExecuteScripts = getExecuteScripts();\r\n      const tmpEl = document.implementation.createHTMLDocument(\"pjax\")\r\n      //Collector array to store the promises in\r\n      const collectForScriptcomplete = [(Promise.resolve(\"basic resolve\"))];\r\n\r\n      //parse HTML attributes to copy them\r\n      //since we are forced to use documentElement.innerHTML (outerHTML can't be used for <html>)\r\n      const htmlRegex = /<html[^>]+>/gi\r\n      const htmlAttribsRegex = /\\s?[a-z:]+(?:=(?:'|\")[^'\">]+(?:'|\"))*/gi\r\n\r\n      let matches = html.match(htmlRegex);\r\n      if (matches && matches.length) {\r\n        matches = matches[0].match(htmlAttribsRegex)\r\n        if (matches.length) {\r\n          matches.shift()\r\n          matches.forEach(function (htmlAttrib) {\r\n            var attr = htmlAttrib.trim().split(\"=\")\r\n            if (attr.length === 1) {\r\n              tmpEl.documentElement.setAttribute(attr[0], true)\r\n            } else {\r\n              tmpEl.documentElement.setAttribute(attr[0], attr[1].slice(1, -1))\r\n            }\r\n          })\r\n        }\r\n      }\r\n\r\n      let jsonContent = null;\r\n      try {\r\n        jsonContent = JSON.parse(html);\r\n      } catch (e) {\r\n        this.log.warn('No JSON found. If ypu expected it there was an error');\r\n      }\r\n\r\n      tmpEl.documentElement.innerHTML = html\r\n      this.log(\"load content\", tmpEl.documentElement.attributes, tmpEl.documentElement.innerHTML.length)\r\n\r\n      if (jsonContent !== null) {\r\n        this.log(\"found JSON document\", jsonContent);\r\n        this.options.onJsonDocument.call(this, jsonContent);\r\n      }\r\n\r\n      // Clear out any focused controls before inserting new page contents.\r\n      // we clear focus on non form elements\r\n      if (document.activeElement && !document.activeElement.value) {\r\n        try {\r\n          document.activeElement.blur()\r\n        } catch (e) {\r\n          // Nothing to do, just ignore any issues\r\n        }\r\n      }\r\n\r\n      this.switchSelectors(this.options.selectors, tmpEl, document, options)\r\n\r\n      //reset stylesheets if activated\r\n      if (this.options.reRenderCSS === true) {\r\n        this.updateStylesheets(tmpEl.querySelectorAll('link[rel=stylesheet]'), document.querySelectorAll('link[rel=stylesheet]'));\r\n      }\r\n\r\n      // FF bug: Won’t autofocus fields that are inserted via JS.\r\n      // This behavior is incorrect. So if theres no current focus, autofocus\r\n      // the last field.\r\n      //\r\n      // http://www.w3.org/html/wg/drafts/html/master/forms.html\r\n      const autofocusEl = Array.prototype.slice.call(document.querySelectorAll(\"[autofocus]\")).pop()\r\n      if (autofocusEl && document.activeElement !== autofocusEl) {\r\n        autofocusEl.focus();\r\n      }\r\n\r\n      // execute scripts when DOM have been completely updated\r\n      this.options.selectors.forEach((selector) => {\r\n        this.oUtilities.forEachEls(document.querySelectorAll(selector), function (el) {\r\n          collectForScriptcomplete.push.apply(collectForScriptcomplete, fnExecuteScripts(el));\r\n        }, this);\r\n      });\r\n      // }\r\n      // catch(e) {\r\n      //   if (this.options.debug) {\r\n      //     this.log(\"Pjax switch fail: \", e)\r\n      //   }\r\n      //   this.switchFallback(tmpEl, document)\r\n      // }\r\n      this.log(\"waiting for scriptcomplete\", collectForScriptcomplete);\r\n\r\n      //Fallback! If something can't be loaded or is not loaded correctly -> just force eventing in error\r\n      let timeOutScriptEvent = null;\r\n      timeOutScriptEvent = window.setTimeout(function () {\r\n        trigger(document, \"pjax:scriptcomplete pjax:scripttimeout\", options)\r\n        timeOutScriptEvent = null;\r\n      }, this.options.scriptloadtimeout);\r\n\r\n      Promise.all(collectForScriptcomplete).then(\r\n        //resolved\r\n        function () {\r\n          if (timeOutScriptEvent !== null) {\r\n            window.clearTimeout(timeOutScriptEvent);\r\n            trigger(document, \"pjax:scriptcomplete pjax:scriptsuccess\", options)\r\n          }\r\n        },\r\n        function () {\r\n          if (timeOutScriptEvent !== null) {\r\n            window.clearTimeout(timeOutScriptEvent);\r\n            trigger(document, \"pjax:scriptcomplete pjax:scripterror\", options)\r\n          }\r\n        }\r\n      );\r\n    }\r\n\r\n    loadUrl(href, options) {\r\n      this.log(\"load href\", href, options)\r\n\r\n      trigger(document, \"pjax:send\", options);\r\n\r\n      // Do the request\r\n      this.doRequest(href, options.requestOptions, (html, requestData) => {\r\n        // Fail if unable to load HTML via AJAX\r\n        if (html === false || requestData.status !== 200) {\r\n          trigger(document, \"pjax:complete pjax:error\", {\r\n            options: options,\r\n            requestData: requestData,\r\n            href: href\r\n          });\r\n          return options.pjaxErrorHandler(href, options, requestData);\r\n        }\r\n\r\n        // Clear out any focused controls before inserting new page contents.\r\n        document.activeElement.blur()\r\n\r\n        try {\r\n          this.loadContent(html, options)\r\n        } catch (e) {\r\n          if (!this.options.debug) {\r\n            if (console && this.options.logObject.error) {\r\n              this.options.logObject.error(\"Pjax switch fail: \", e)\r\n            }\r\n            return options.pjaxErrorHandler(href, options, requestData) || this.latestChance(href);\r\n          } else {\r\n            if (this.options.forceRedirectOnFail) {\r\n              return options.pjaxErrorHandler(href, options, requestData) || this.latestChance(href);\r\n            }\r\n            throw e;\r\n          }\r\n        }\r\n\r\n        if (options.history) {\r\n          if (this.firstrun) {\r\n            this.lastUid = this.maxUid = oUtilities.newUid()\r\n            this.firstrun = false\r\n            window.history.replaceState({\r\n                url: window.location.href,\r\n                title: document.title,\r\n                uid: this.maxUid\r\n              },\r\n              document.title)\r\n          }\r\n\r\n          // Update browser history\r\n          this.lastUid = this.maxUid = oUtilities.newUid()\r\n          window.history.pushState({\r\n              url: href,\r\n              title: options.title,\r\n              uid: this.maxUid\r\n            },\r\n            options.title,\r\n            href)\r\n        }\r\n\r\n        this.forEachSelectors(el => this.parseDOM(el));\r\n\r\n        // Fire Events\r\n        trigger(document, \"pjax:complete pjax:success\", options)\r\n\r\n        options.analytics()\r\n\r\n        // Scroll page to top on new page load\r\n        if (options.scrollTo !== false) {\r\n          if (options.scrollTo.length > 1) {\r\n            window.scrollTo(options.scrollTo[0], options.scrollTo[1])\r\n          } else {\r\n            window.scrollTo(0, options.scrollTo)\r\n          }\r\n        }\r\n      })\r\n    }\r\n  };\r\n  \r\n  // if there isn’t required browser functions, returning stupid api\r\n  if (!getUtility().isSupported()) {\r\n    const stupidPjax = function () {}\r\n    for (let key in Pjax.prototype) {\r\n      if (key in Pjax.prototype && typeof Pjax.prototype[key] === \"function\") {\r\n        stupidPjax[key] = stupidPjax\r\n      }\r\n    }\r\n    return stupidPjax;\r\n  }\r\n\r\n  return Pjax;\r\n}\r\n\r\nexport default new PjaxFactory();\r\n"],"names":["Array","prototype","from","enumerable","arr","i","length","unshift","forEachEls","els","fn","ctx","HTMLCollection","NodeList","forEach","el","call","getElements","querySelectorAll","options","elements","clone","obj","copy","constructor","attr","isSupported","window","history","pushState","replaceState","navigator","userAgent","match","newUid","counter","id","Date","getTime","events","listener","useCapture","split","e","addEventListener","debug","logObject","log","apply","arguments","opts","event","document","createEvent","initEvent","eventName","Object","keys","key","domFix","parentNode","body","appendChild","dispatchEvent","removeChild","location","callback","requestMethod","requestPayload","requestPayloadString","request","XMLHttpRequest","onreadystatechange","readyState","status","responseText","cacheBust","test","open","toUpperCase","setRequestHeader","undefined","send","outerHTML","oldEl","newEl","onSwitch","innerHTML","className","sideBySide","switchOptions","elsToRemove","elsToAdd","fragToAppend","createDocumentFragment","animationEventNames","animatedElsNumber","sexyAnimationEnd","target","currentTarget","replace","getAttribute","removeAttribute","bind","childNodes","push","classList","contains","hasAttribute","add","callbacks","removeElement","classNames","remove","backward","forward","on","addClasses","addElement","setAttribute","switches","switchesOptions","selectors","fromEl","toEl","selector","newEls","oldEls","throwError","onDomDiffers","defaultSwitches","Function","oThis","TypeError","aArgs","slice","that","Fnoop","fBound","concat","attrClick","attrKey","linkAction","which","metaKey","ctrlKey","shiftKey","altKey","protocol","host","pathname","hash","href","preventDefault","currentUrlFullReload","reload","requestOptions","loadUrl","isDefaultPrevented","defaultPrevented","returnValue","keyCode","formAction","requestUrl","virtLinkElement","createElement","nameList","paramObject","elementKey","element","name","attributes","tagName","toLowerCase","type","checked","indexOf","String","nodeName","multiple","selected","map","item","value","encodeURIComponent","paramsString","join","this","querySelector","mainScriptElement","code","text","textContent","console","src","parent","documentElement","script","promise","Promise","resolve","async","createTextNode","removeScriptsAfterParsing","executeScripts","loadingScripts","evalScript","removeEventListener","off","oldElements","resemblingOld","reduce","acc","head","getElementsByTagName","link","parseElementUnload","unattachLink","unattachForm","parseElement","attachLink","attachForm","parseDOMUnload","parseDOM","parseOptions","reRenderCSS","forceRedirectOnFail","scriptloadtimeout","latestChance","pjaxErrorHandler","onJsonDocument","analytics","_gaq","ga","page","title","scrollTo","switchElementsAlt","refresh","foreachSelectors","cb","context","DOMcontext","unattach","PjaxFactory","Pjax","firstrun","oUtilities","getUtility","oDomUtils","getDomUtils","oParsers","getParsers","doRequest","getAttachLink","getAttachForm","getUnattachLink","getUnattachForm","updateStylesheets","getUpdateStylesheets","maxUid","lastUid","st","state","opt","url","uid","switchSelectors","trigger","html","fnExecuteScripts","getExecuteScripts","tmpEl","implementation","createHTMLDocument","collectForScriptcomplete","htmlRegex","htmlAttribsRegex","matches","shift","htmlAttrib","trim","jsonContent","JSON","parse","warn","activeElement","blur","autofocusEl","pop","focus","timeOutScriptEvent","setTimeout","all","then","clearTimeout","requestData","loadContent","error","forEachSelectors","stupidPjax"],"mappings":"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"}